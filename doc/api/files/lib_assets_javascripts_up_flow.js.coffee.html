<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>lib/assets/javascripts/up/flow.js.coffee - up.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">up.js</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 0.0
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/up.browser.html">up.browser</a></li>
                                <li><a href="../classes/up.bus.html">up.bus</a></li>
                                <li><a href="../classes/up.flow.html">up.flow</a></li>
                                <li><a href="../classes/up.form.html">up.form</a></li>
                                <li><a href="../classes/up.history.html">up.history</a></li>
                                <li><a href="../classes/up.link.html">up.link</a></li>
                                <li><a href="../classes/up.magic.html">up.magic</a></li>
                                <li><a href="../classes/up.marker.html">up.marker</a></li>
                                <li><a href="../classes/up.modal.html">up.modal</a></li>
                                <li><a href="../classes/up.motion.html">up.motion</a></li>
                                <li><a href="../classes/up.navigation.html">up.navigation</a></li>
                                <li><a href="../classes/up.popup.html">up.popup</a></li>
                                <li><a href="../classes/up.tooltip.html">up.tooltip</a></li>
                                <li><a href="../classes/up.util.html">up.util</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/up.html">up</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/assets/javascripts/up/flow.js.coffee</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        ###*
                        Page flow.
                        
                        @class up.flow
                        ###
                        up.flow = (-&gt;
                          
                          u = up.util
                        
                          setSource = (element, sourceUrl) -&gt;
                            $element = $(element)
                            sourceUrl = u.normalizeUrl(sourceUrl) if u.isPresent(sourceUrl)
                            $element.attr(&quot;up-source&quot;, sourceUrl)
                        
                          source = (element) -&gt;
                            $element = $(element).closest(&quot;[up-source]&quot;)
                            u.presence($element.attr(&quot;up-source&quot;)) || up.browser.url()
                        
                          ###*
                          Replaces elements on the current page with corresponding elements
                          from a new page fetched from the server.
                        
                          The current and new elements must have the same CSS selector.
                        
                          @method up.replace
                          @param {String|Element|jQuery} selectorOrElement
                            The CSS selector to update. You can also pass a DOM element or jQuery element
                            here, in which case a selector will be inferred from the element&#x27;s class and ID.
                          @param {String} url
                            The URL to fetch from the server.
                          @param {String} [options.title]
                          @param {String|Boolean} [options.history=true]
                            If a &#x60;String&#x60; is given, it is used as the URL the browser&#x27;s location bar and history.
                            If omitted or true, the &#x60;url&#x60; argument will be used.
                            If set to &#x60;false&#x60;, the history will remain unchanged.
                          @param {String|Boolean} [options.source=true]
                          @param {String} [options.transition]
                          @param {String} [options.historyMethod=&#x27;push&#x27;]
                          ###
                          replace = (selectorOrElement, url, options) -&gt;
                        
                            options = u.options(options)
                            
                            selector = if u.presence(selectorOrElement)
                              selectorOrElement
                            else
                              u.createSelectorFromElement($(selectorOrElement))
                        
                            if u.isMissing(options.history) || u.castsToTrue(options.history) 
                              options.history = url
                            
                            if u.isMissing(options.source) || u.castsToTrue(options.source)
                              options.source = url
                              
                            u.get(url, selector: selector)
                              .done (html) -&gt; implant(selector, html, options)
                              .fail(u.error)
                        
                          ###*
                          Replaces the given selector with the same selector from the given HTML string.
                          
                          @method up.flow.implant
                          @protected
                          @param {String} selector
                          @param {String} html
                          @param {String} [options.title]
                          @param {String} [options.source]
                          @param {Object} [options.transition]
                          @param {String] [options.history]
                          @param {String] [options.historyMethod=&#x27;push&#x27;]
                          ###
                          implant = (selector, html, options) -&gt;
                            
                            options = u.options(options, 
                              historyMethod: &#x27;push&#x27;
                            )
                            # jQuery cannot construct transient elements that contain &lt;html&gt; or &lt;body&gt; tags,
                            # so we&#x27;re using the native browser API to grep through the HTML
                            htmlElement = u.createElementFromHtml(html)
                        
                            # TODO: extract title from HTTP header
                            options.title ||= htmlElement.querySelector(&quot;title&quot;)?.textContent 
                        
                            for step in implantSteps(selector, options)
                              $old =
                                # always prefer to replace content in popups or modals
                                u.presence($(&quot;.up-popup &quot; + step.selector)) || 
                                u.presence($(&quot;.up-modal &quot; + step.selector)) || 
                                u.presence($(step.selector)) 
                              if fragment = htmlElement.querySelector(step.selector)
                                $new = $(fragment)
                                swapElements $old, $new, step.pseudoClass, step.transition, options
                              else
                                u.error(&quot;Could not find selector (#{step.selector}) in response (#{html})&quot;)
                                
                          elementsInserted = ($new, options) -&gt;
                            $new.each -&gt;
                              $element = $(this)
                              options.insert?($element)
                              if options.history
                                document.title = options.title if options.title
                                up.history[options.historyMethod](options.history)
                              # Remember where the element came from so we can
                              # offer reload functionality.
                              setSource($element, u.presence(options.source) || options.history)
                              autofocus($element)
                              # The fragment should be readiet before the transition,
                              # so transitions see .up-current classes
                              up.ready($element)
                        
                          swapElements = ($old, $new, pseudoClass, transition, options) -&gt;
                            transition ||= &#x27;none&#x27;
                            if pseudoClass
                              insertionMethod = if pseudoClass == &#x27;before&#x27; then &#x27;prepend&#x27; else &#x27;append&#x27;
                              # Keep a reference to the children append/prepend because
                              # we need to compile them further down
                              $addedChildren = $new.children()
                              # Insert contents() instead of $children since contents()
                              # also includes text nodes.
                              $old[insertionMethod]($new.contents())
                              u.copyAttributes($new, $old)
                              elementsInserted($addedChildren, options)
                              # Since we&#x27;re adding content instead of replacing, we&#x27;ll only
                              # animate $new instead of morphing between $old and $new
                              up.animate($new, transition)
                            else
                              # Wrap the replacement as a destroy animation, so $old will
                              # get marked as .up-destroying right away.
                              destroy $old, animation: -&gt;
                                $new.insertAfter($old)
                                elementsInserted($new, options)
                                if $old.is(&#x27;body&#x27;) &amp;&amp; transition != &#x27;none&#x27;
                                  u.error(&#x27;Cannot apply transitions to body-elements&#x27;, transition)
                                up.morph($old, $new, transition)
                        
                          implantSteps = (selector, options) -&gt;
                            transitionString = options.transition || options.animation || &#x27;none&#x27;
                            comma = /\ *,\ */
                            disjunction = selector.split(comma)
                            transitions = transitionString.split(comma) if u.isPresent(transitionString)    
                            for selectorAtom, i in disjunction
                              # Splitting the atom
                              selectorParts = selectorAtom.match(/^(.+?)(?:\:(before|after))?$/)
                              transition = transitions[i] || u.last(transitions)
                              selector: selectorParts[1]
                              pseudoClass: selectorParts[2]
                              transition: transition
                        
                          autofocus = ($element) -&gt;
                            selector = &#x27;[autofocus]:last&#x27;
                            $control = u.findWithSelf($element, selector)
                            if $control.length &amp;&amp; $control.get(0) != document.activeElement
                              $control.focus()
                              
                        #  executeScripts = ($new) -&gt;
                        #    $new.find(&#x27;script&#x27;).each -&gt;
                        #      $script = $(this)
                        #      type = $script.attr(&#x27;type&#x27;)
                        #      if u.isBlank(type) || type.indexOf(&#x27;text/javascript&#x27;) == 0
                        #        code = $script.text()
                        #        console.log(&quot;Evaling javascript code&quot;, code)
                        #        eval(code)
                              
                          ###*
                          Destroys the given element or selector.
                          Takes care that all destructors, if any, are called.
                          
                          @method up.destroy
                          @param {String|Element|jQuery} selectorOrElement 
                          @param {String|Function|Object} [options.animation]
                          @param {String} [options.url]
                          @param {String} [options.title]
                          ###
                          destroy = (selectorOrElement, options) -&gt;
                            $element = $(selectorOrElement)
                            options = u.options(options, animation: &#x27;none&#x27;)
                            $element.addClass(&#x27;up-destroying&#x27;)
                            # If e.g. a modal or popup asks us to restore a URL, do this
                            # before emitting &#x60;fragment:destroy&#x60;. This way up.navigate sees the
                            # new URL and can assign/remove .up-current classes accordingly.
                            up.history.push(options.url) if u.isPresent(options.url)
                            document.title = options.title if u.isPresent(options.title)
                            up.bus.emit(&#x27;fragment:destroy&#x27;, $element)
                            animationPromise = u.presence(options.animation, u.isPromise) ||
                              up.motion.animate($element, options.animation)
                            animationPromise.then -&gt; $element.remove()
                            
                              
                          ###*
                          Replaces the given selector or element with a fresh copy
                          fetched from the server.
                        
                          @method up.reload
                          @param {String|Element|jQuery} selectorOrElement
                          ###
                          reload = (selectorOrElement) -&gt;
                            sourceUrl = source(selectorOrElement)
                            replace(selectorOrElement, sourceUrl)
                        
                          ###*
                          Resets Up.js to the state when it was booted.
                          All custom event handlers, animations, etc. that have been registered
                          will be discarded.
                          
                          This is an internal method for to enable unit testing.
                          Don&#x27;t use this in production.
                          
                          @protected
                          @method up.reset
                          ###
                          reset = -&gt;
                            up.bus.emit(&#x27;framework:reset&#x27;)
                          
                          up.bus.on(&#x27;app:ready&#x27;, -&gt;
                            setSource(document.body, up.browser.url())
                          )
                        
                          replace: replace
                          reload: reload
                          destroy: destroy
                          implant: implant
                          reset: reset
                        
                        )()
                        
                        up.replace = up.flow.replace
                        up.reload = up.flow.reload
                        up.destroy = up.flow.destroy
                        up.reset = up.flow.reset
                        
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>
</script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
