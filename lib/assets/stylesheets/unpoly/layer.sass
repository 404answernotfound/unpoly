///////////////////////////////////////////////////////////////////////////////
// Virtual elements shared by multiple overlay modes
///////////////////////////////////////////////////////////////////////////////

$overlay-z-index: 999
$overlay-backdrop: rgba(90, 90, 90, 0.4)
$modal-margin-x: 15px
$modal-margin-y: 25px

html
  // The z-indexes of all overlays depenend on a CSS custom property on the root element.
  // This way users can change the height of all Unpoly overlays with a single CSS override.
  --up-overlay-z-index: $overlay-z-index
  --up-overlay-backdrop: $overlay-backdrop

  --up-modal-margin-x: $modal-margin-x
  --up-modal-margin-y: $modal-margin-y

%overlay-z-index
  z-index: $overlay-z-index // Fallback for IE11
  z-index: var(--up-overlay-z-index)

%maximize
  top: 0
  left: 0
  bottom: 0
  right: 0

%large-shadow
  box-shadow: 0 0 10px 1px rgba(0, 0, 0, 0.3)

%small-shadow
  box-shadow: 0 0 4px rgba(0, 0, 0, 0.3)

%overlay-with-viewport
  @extend %maximize
  // Create a stacking context for child elements by giving a position and z-index.
  // This way the z-indexes of our child elements don't need to be defined.
  @extend %overlay-z-index
  position: fixed

%overlay-with-tether
  @extend %overlay-z-index
  position: absolute

%overlay-backdrop
  @extend %maximize
  position: absolute
  background: $overlay-backdrop // Fallback for IE11
  background: var(--up-overlay-backdrop)

%overlay-viewport
  @extend %maximize
  position: absolute

  // The viewport always has a scrollbar, except when we're animating (see below)
  overflow-y: scroll
  overflow-x: hidden

  // Prevent users from scrolling a parent layer when they bump
  // into the end of this layer's viewport.
  overscroll-behavior: contain

  // Center .up-overlay-box within the viewport
  text-align: center

%overlay-box
  // Make it grow with the width of .up-overlay-content
  display: inline-block
  text-align: left

  position: relative

  // Include the padding in any width that might be set on the frame
  box-sizing: border-box

  max-width: 100%
  background-color: #fff
  padding: 20px

  overflow-x: hidden

%overlay-dismiss
  color: #666
  position: absolute
  top: 5px
  right: 5px

// Links that close a layer
[up-dismiss], [up-accept]
  cursor: pointer

///////////////////////////////////////////////////////////////////////////////
// Modals are a centered window with its own scrollbar, growing with its content
///////////////////////////////////////////////////////////////////////////////
up-modal
  @extend %overlay-with-viewport

up-modal-backdrop
  @extend %overlay-backdrop

=modal-viewport-padding($factor)
  padding: ($modal-margin-y * $factor) ($modal-margin-x * $factor)
  padding: calc(var(--up-modal-margin-y) * #{$factor}) calc(var(--up-modal-margin-x) * #{$factor})

up-modal-viewport
  @extend %overlay-viewport

  // Implement the margin around the dialog box with a padding of the viewport.
  // This way we can give .up-overlay-box a max-width of 100%, (1) preventing people
  // from setting withs larger than the viewport, and (2) sizing approproately
  // if the modal contents are very wide and cannot wrap (e.g. code blocks).
  +modal-viewport-padding(1)

  // Allow frame to grow from the center, up to its max-width of 100%
  justify-content: center

  up-modal + up-modal &
    +modal-viewport-padding(2)

  up-modal + up-modal + up-modal &
    +modal-viewport-padding(3)

  up-modal + up-modal + up-modal + up-modal &
    +modal-viewport-padding(4)

up-modal-box
  @extend %overlay-box
  @extend %large-shadow

up-modal-dismiss
  @extend %overlay-dismiss


///////////////////////////////////////////////////////////////////////////////
// Drawers are a full-height modal clinging to the left or right edge of the screen
///////////////////////////////////////////////////////////////////////////////
up-drawer
  @extend %overlay-with-viewport

up-drawer-backdrop
  @extend %overlay-backdrop

up-drawer-viewport
  @extend %overlay-viewport

  // Allow frame to grow from the left, up to its max-width of 100%
  text-align: left

  up-drawer[position=right] &
    // Allow frame to grow from the right, up to its max-width of 100%
    text-align: right

up-drawer-box
  @extend %overlay-box
  @extend %large-shadow
  min-height: 100vh

up-drawer-dismiss
  @extend %overlay-dismiss


///////////////////////////////////////////////////////////////////////////////
// Cover is an overlay that fills the entire screen
///////////////////////////////////////////////////////////////////////////////
up-cover
  @extend %overlay-with-viewport

up-cover-viewport
  @extend %overlay-viewport

up-cover-box
  @extend %overlay-box
  width: 100%
  min-height: 100vh

  // We assume the developer wants to embed a full application layout
  // into a cover overlay. That layout will either want to touch the screen
  // edges, so we remove all padding.
  padding: 0

up-cover-dismiss
  @extend %overlay-dismiss


///////////////////////////////////////////////////////////////////////////////
// Popup is a small box that is anchored to a link
///////////////////////////////////////////////////////////////////////////////
up-popup
  @extend %overlay-box
  @extend %small-shadow

  // The small popup box looks better with a tighter padding.
  padding: 15px

up-popup-dismiss
  @extend %overlay-dismiss
